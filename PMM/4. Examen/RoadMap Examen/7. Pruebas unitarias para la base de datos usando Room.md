
# Ejemplo:

```kotlin
import androidx.room.Room
import androidx.test.core.app.ApplicationProvider
import androidx.test.ext.junit.runners.AndroidJUnit4
import kotlinx.coroutines.runBlocking
import org.junit.After
import org.junit.Before
import org.junit.Test
import org.junit.runner.RunWith
import java.io.IOException

@RunWith(AndroidJUnit4::class)
class UserRepositoryTest {

    private lateinit var userDao: UserDao
    private lateinit var db: AppDatabase
    private lateinit var userRepository: UserRepository

    @Before
    fun createDb() {
        db = Room.inMemoryDatabaseBuilder(
            ApplicationProvider.getApplicationContext(),
            AppDatabase::class.java
        ).allowMainThreadQueries().build()
        userDao = db.userDao()
        userRepository = UserRepository(userDao)
    }

    @After
    @Throws(IOException::class)
    fun closeDb() {
        db.close()
    }

    @Test
    @Throws(Exception::class)
    fun insertAndGetUser() = runBlocking {
        val user = User(1, "John Doe", 25)
        userRepository.insert(user)
        val userById = userRepository.getUserById(1)
        assert(userById != null)
        assert(userById?.name == "John Doe")
    }

    @Test
    @Throws(Exception::class)
    fun deleteAllUsers() = runBlocking {
        val user = User(1, "John Doe", 25)
        userRepository.insert(user)
        userRepository.deleteAllUsers()
        val users = userRepository.getAllUsers()
        assert(users.isEmpty())
    }
}
```


### **ğŸ“Œ ExplicaciÃ³n de los Test Unitarios para Room (Base de Datos)**

Este test verifica que la base de datos **Room** funciona correctamente.  
Se ejecuta en **un entorno de prueba** sin necesidad de una `Activity` real.

ğŸ“Œ **Â¿QuÃ© hace este test?**  
âœ… Crea una base de datos en memoria para pruebas.  
âœ… Inserta un usuario y comprueba que se puede recuperar.  
âœ… Borra todos los usuarios y verifica que la base de datos queda vacÃ­a.

---

## **ğŸ“ ExplicaciÃ³n de cada parte del cÃ³digo**

### **1ï¸âƒ£ ConfiguraciÃ³n inicial de las pruebas**

```kotlin
@RunWith(AndroidJUnit4::class)
class UserRepositoryTest {
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `@RunWith(AndroidJUnit4::class)` â†’ Indica que los tests deben ejecutarse en un entorno Android.  
âœ” `UserRepositoryTest` â†’ Es la clase que contiene los tests para la base de datos.

---

### **2ï¸âƒ£ Variables de prueba**

```kotlin
private lateinit var userDao: UserDao
private lateinit var db: AppDatabase
private lateinit var userRepository: UserRepository
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `userDao` â†’ Accede a la base de datos para realizar consultas.  
âœ” `db` â†’ Representa la base de datos Room.  
âœ” `userRepository` â†’ Es la capa que maneja las operaciones de la base de datos.

---

### **3ï¸âƒ£ Crear la base de datos en memoria antes de cada test (`@Before`)**

```kotlin
@Before
fun createDb() {
    db = Room.inMemoryDatabaseBuilder(
        ApplicationProvider.getApplicationContext(),
        AppDatabase::class.java
    ).allowMainThreadQueries().build()
    userDao = db.userDao()
    userRepository = UserRepository(userDao)
}
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `@Before` â†’ Se ejecuta antes de cada prueba para inicializar la base de datos.  
âœ” `Room.inMemoryDatabaseBuilder()` â†’ Crea **una base de datos temporal en RAM** (no se guarda en el dispositivo).  
âœ” `allowMainThreadQueries()` â†’ Permite ejecutar consultas en el hilo principal (solo para pruebas).  
âœ” `db.userDao()` â†’ Obtiene el DAO para interactuar con la base de datos.  
âœ” `UserRepository(userDao)` â†’ Crea una instancia del repositorio con el DAO.

âœ… **Beneficio de usar `inMemoryDatabaseBuilder()`**

- **Es mÃ¡s rÃ¡pido** porque usa la memoria en lugar del almacenamiento interno.
- **Los datos se borran al final de cada test**, evitando interferencias entre pruebas.

---

### **4ï¸âƒ£ Cerrar la base de datos despuÃ©s de cada test (`@After`)**

```kotlin
@After
@Throws(IOException::class)
fun closeDb() {
    db.close()
}
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `@After` â†’ Se ejecuta despuÃ©s de cada prueba para **cerrar la base de datos**.  
âœ” `db.close()` â†’ Libera los recursos usados en la prueba.

âœ… **Evita consumir memoria innecesariamente entre pruebas.**

---

### **5ï¸âƒ£ Test para insertar y recuperar un usuario**

```kotlin
@Test
@Throws(Exception::class)
fun insertAndGetUser() = runBlocking {
    val user = User(1, "John Doe", 25)
    userRepository.insert(user)
    val userById = userRepository.getUserById(1)
    assert(userById != null)
    assert(userById?.name == "John Doe")
}
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `@Test` â†’ Define que esta funciÃ³n es una prueba.  
âœ” `runBlocking` â†’ Permite ejecutar cÃ³digo suspendido en un entorno de pruebas.  
âœ” `userRepository.insert(user)` â†’ Inserta un usuario en la base de datos.  
âœ” `userRepository.getUserById(1)` â†’ Recupera el usuario insertado.  
âœ” `assert(userById != null)` â†’ Verifica que el usuario **realmente existe** en la base de datos.  
âœ” `assert(userById?.name == "John Doe")` â†’ Verifica que el nombre guardado es correcto.

âœ… **Si este test pasa, significa que la base de datos guarda y recupera datos correctamente.**

---

### **6ï¸âƒ£ Test para eliminar todos los usuarios**

```kotlin
@Test
@Throws(Exception::class)
fun deleteAllUsers() = runBlocking {
    val user = User(1, "John Doe", 25)
    userRepository.insert(user)
    userRepository.deleteAllUsers()
    val users = userRepository.getAllUsers()
    assert(users.isEmpty())
}
```

ğŸ“Œ **ExplicaciÃ³n:**  
âœ” `userRepository.insert(user)` â†’ Guarda un usuario en la base de datos.  
âœ” `userRepository.deleteAllUsers()` â†’ Elimina todos los usuarios de la base de datos.  
âœ” `userRepository.getAllUsers()` â†’ Recupera la lista de usuarios.  
âœ” `assert(users.isEmpty())` â†’ Verifica que la lista estÃ¡ vacÃ­a.

âœ… **Si este test pasa, significa que la funciÃ³n de eliminaciÃ³n funciona correctamente.**

---

## **ğŸ“Œ Resumen**

|**Test**|**AcciÃ³n**|**VerificaciÃ³n**|
|---|---|---|
|`insertAndGetUser()`|Inserta un usuario y lo recupera|El usuario existe en la base de datos y tiene el nombre correcto|
|`deleteAllUsers()`|Inserta un usuario y borra todos|La base de datos queda vacÃ­a|
